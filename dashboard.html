<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Digital Marketing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .loading { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-gray-900">Digital Marketing Dashboard</h1>
                    <span id="userRoleBadge" class="ml-4 px-3 py-1 text-xs font-medium rounded-full"></span>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="lastUpdate" class="text-sm text-gray-500"></span>
                    
                    <!-- Data Source Selector -->
                    <select id="dataSourceSelector" class="px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="demo">Demo Data</option>
                        <option value="existing">Existing Sheet</option>
                        <option value="new">Live Dashboard</option>
                    </select>
                    
                    <button id="refreshBtn" class="px-3 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        Refresh
                    </button>
                    <button id="analyzeBtn" class="px-3 py-2 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition hidden">
                        Analyze Sheet
                    </button>
                    <button id="logoutBtn" class="px-3 py-2 text-sm bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition">
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Filter Controls -->
        <section id="filterSection" class="mb-8">
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Filters</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label for="filterDateFrom" class="block text-sm font-medium text-gray-700 mb-2">From Date</label>
                        <input type="date" id="filterDateFrom" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label for="filterDateTo" class="block text-sm font-medium text-gray-700 mb-2">To Date</label>
                        <input type="date" id="filterDateTo" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label for="filterVendor" class="block text-sm font-medium text-gray-700 mb-2">Vendor</label>
                        <input type="text" id="filterVendor" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Search vendor...">
                    </div>
                    <div>
                        <label for="filterChannel" class="block text-sm font-medium text-gray-700 mb-2">Channel</label>
                        <select id="filterChannel" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">All Channels</option>
                            <option value="Instagram">Instagram</option>
                            <option value="TikTok">TikTok</option>
                            <option value="Facebook">Facebook</option>
                            <option value="Google Ads">Google Ads</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>

        <!-- Summary Boxes -->
        <section id="summarySection" class="mb-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-600">Total Budget</p>
                            <p id="totalBudget" class="text-2xl font-bold text-gray-900">Rp 0</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                            <div class="w-6 h-6 bg-blue-600 rounded"></div>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-600">Total Lead</p>
                            <p id="totalLead" class="text-2xl font-bold text-gray-900">0</p>
                        </div>
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                            <div class="w-6 h-6 bg-green-600 rounded"></div>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-600">Average ROAS</p>
                            <p id="avgROAS" class="text-2xl font-bold text-gray-900">0.00</p>
                        </div>
                        <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                            <div class="w-6 h-6 bg-yellow-600 rounded"></div>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-600">Total Revenue</p>
                            <p id="totalRevenue" class="text-2xl font-bold text-gray-900">Rp 0</p>
                        </div>
                        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                            <div class="w-6 h-6 bg-purple-600 rounded"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Chart Section -->
        <section class="mb-8">
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Daily Performance</h2>
                <div class="relative h-96">
                    <canvas id="dailyChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Additional Charts for Manager -->
        <section id="managerChartsSection" class="mb-8 hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Weekly Performance Chart -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Weekly Performance vs Target</h3>
                    <div class="relative h-64">
                        <canvas id="weeklyChart"></canvas>
                    </div>
                </div>
                
                <!-- Vendor Composition Chart -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Lead Distribution by Vendor</h3>
                    <div class="relative h-64">
                        <canvas id="vendorChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Manager KPI Section -->
        <section id="managerKPISection" class="mb-8 hidden">
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Manager Dashboard - KPI & Analytics</h2>
                
                <!-- Time Progress & Gap Analysis -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg p-4 text-white">
                        <h4 class="text-sm font-medium mb-2">Time Progress (Bulan Ini)</h4>
                        <div class="flex items-center justify-between">
                            <span id="timeProgress" class="text-2xl font-bold">0%</span>
                            <div class="w-16 h-16 relative">
                                <svg class="w-16 h-16 transform -rotate-90">
                                    <circle cx="32" cy="32" r="28" stroke="rgba(255,255,255,0.3)" stroke-width="4" fill="none"/>
                                    <circle id="timeProgressCircle" cx="32" cy="32" r="28" stroke="white" stroke-width="4" fill="none" stroke-dasharray="176" stroke-dashoffset="176"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-lg p-4 text-white">
                        <h4 class="text-sm font-medium mb-2">Target Achievement</h4>
                        <div class="flex items-center justify-between">
                            <span id="targetAchievement" class="text-2xl font-bold">0%</span>
                            <div class="text-right">
                                <p class="text-xs opacity-80">vs Target</p>
                                <p id="gapAnalysis" class="text-sm font-semibold">Gap: 0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg p-4 text-white">
                        <h4 class="text-sm font-medium mb-2">Avg Closing Rate</h4>
                        <div class="flex items-center justify-between">
                            <span id="avgClosingRate" class="text-2xl font-bold">0%</span>
                            <div class="text-right">
                                <p class="text-xs opacity-80">All CS</p>
                                <p id="bestCS" class="text-sm font-semibold">Best: -</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CS Performance Table -->
                <div class="mb-6">
                    <h4 class="text-md font-semibold text-gray-900 mb-3">CS Individual Performance</h4>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">CS Name</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Total Follow-Up</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Closing</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Closing %</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Revenue</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Rank</th>
                                </tr>
                            </thead>
                            <tbody id="csPerformanceTable" class="bg-white divide-y divide-gray-200">
                                <!-- CS performance data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Export & Actions -->
                <div class="flex flex-wrap gap-3">
                    <button id="exportPDFBtn" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
                        Export PDF Report
                    </button>
                    <button id="exportExcelBtn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                        Export Excel
                    </button>
                    <button id="sendReportBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        Send Daily Report
                    </button>
                </div>
            </div>
        </section>

        <!-- Table Section -->
        <section class="mb-8">
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-semibold text-gray-900">Daily Realization</h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vendor</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Channel</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Budget</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lead</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">CPL</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ROAS</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Revenue</th>
                            </tr>
                        </thead>
                        <tbody id="dataTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Table rows will be injected here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- PPC Data Input Form - Sesuai Struktur Spreadsheet -->
        <section id="ppcFormSection" class="mb-8 hidden">
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Input Data Iklan (PPC)</h2>
                <p class="text-sm text-gray-600 mb-4">Form input sesuai dengan struktur spreadsheet</p>
                <form id="ppcForm" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div>
                            <label for="ppcTanggal" class="block text-sm font-medium text-gray-700 mb-2">Tanggal</label>
                            <input type="date" id="ppcTanggal" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label for="ppcBudgetAwareness" class="block text-sm font-medium text-gray-700 mb-2">Budget Iklan Awareness & Traffic (Rp)</label>
                            <input type="number" id="ppcBudgetAwareness" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0">
                        </div>
                        <div>
                            <label for="ppcBudgetConversion" class="block text-sm font-medium text-gray-700 mb-2">Budget Iklan Conversion (Rp)</label>
                            <input type="number" id="ppcBudgetConversion" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0">
                        </div>
                        <div>
                            <label for="ppcPajakIklan" class="block text-sm font-medium text-gray-700 mb-2">Pajak Iklan (Rp)</label>
                            <input type="number" id="ppcPajakIklan" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0">
                        </div>
                        <div>
                            <label for="ppcTotalBudget" class="block text-sm font-medium text-gray-700 mb-2">Total Budget Iklan (Rp)</label>
                            <input type="number" id="ppcTotalBudget" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" readonly>
                        </div>
                        <div>
                            <label for="ppcKontak" class="block text-sm font-medium text-gray-700 mb-2">Kontak</label>
                            <input type="number" id="ppcKontak" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0">
                        </div>
                        <div>
                            <label for="ppcCPA" class="block text-sm font-medium text-gray-700 mb-2">CPA (Rp)</label>
                            <input type="number" id="ppcCPA" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0">
                        </div>
                        <div>
                            <label for="ppcLead" class="block text-sm font-medium text-gray-700 mb-2">Lead</label>
                            <input type="number" id="ppcLead" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" required>
                        </div>
                        <div>
                            <label for="ppcCPL" class="block text-sm font-medium text-gray-700 mb-2">CPL (Rp)</label>
                            <input type="number" id="ppcCPL" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" readonly>
                        </div>
                        <div>
                            <label for="ppcSisaIklan" class="block text-sm font-medium text-gray-700 mb-2">Sisa Iklan (Rp)</label>
                            <input type="number" id="ppcSisaIklan" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0">
                        </div>
                        <div>
                            <label for="ppcVendor" class="block text-sm font-medium text-gray-700 mb-2">Vendor</label>
                            <input type="text" id="ppcVendor" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Nama Vendor" required>
                        </div>
                    </div>
                    <div id="ppcError" class="text-red-500 text-sm"></div>
                    <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition font-medium">
                        Submit Data Iklan
                    </button>
                </form>
            </div>
        </section>

        <!-- CS Data Input Form -->
        <section id="csFormSection" class="mb-8 hidden">
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Input Data Harian (CS)</h2>
                <form id="csForm" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="csDate" class="block text-sm font-medium text-gray-700 mb-2">Tanggal</label>
                            <input type="date" id="csDate" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>
                        <div>
                            <label for="csTotalLeadFollowUp" class="block text-sm font-medium text-gray-700 mb-2">Total Lead Follow-Up</label>
                            <input type="number" id="csTotalLeadFollowUp" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" required>
                        </div>
                        <div>
                            <label for="csClosing" class="block text-sm font-medium text-gray-700 mb-2">Closing</label>
                            <input type="number" id="csClosing" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" required>
                        </div>
                        <div>
                            <label for="csGhosting" class="block text-sm font-medium text-gray-700 mb-2">Ghosting</label>
                            <input type="number" id="csGhosting" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" required>
                        </div>
                        <div>
                            <label for="csDuplicate" class="block text-sm font-medium text-gray-700 mb-2">Duplicate</label>
                            <input type="number" id="csDuplicate" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" required>
                        </div>
                        <div>
                            <label for="csClosingPercentage" class="block text-sm font-medium text-gray-700 mb-2">Closing Percentage (%)</label>
                            <input type="number" id="csClosingPercentage" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" step="0.01" readonly>
                        </div>
                    </div>
                    <div id="csError" class="text-red-500 text-sm"></div>
                    <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition font-medium">
                        Submit Data CS
                    </button>
                </form>
            </div>
        </section>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
            <div class="bg-white rounded-lg p-6 flex items-center space-x-3">
                <div class="loading w-6 h-6 bg-blue-600 rounded-full"></div>
                <span class="text-gray-700">Loading...</span>
            </div>
        </div>
    </main>

    <script src="js/chart.js"></script>
    <script src="js/dashboard.js"></script>
</body>
</html>
